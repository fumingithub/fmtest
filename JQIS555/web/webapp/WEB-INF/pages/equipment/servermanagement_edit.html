<#include "../common/_public.html"/>
<!-- <div class="bjui-pageHeader" style="background:#FFF;"> -->
<!-- 	<div class="row" style="height:70px"> -->
<!-- 		<div class="col-md-12"> -->
<!-- 			<div class="office"> -->
<!-- 				<ul class="offbtn"> -->
<!-- 					<li><a id="lbtnSave" class="submit"><span class="iconbg04"><i -->
<!-- 								class="fa fa-save font24"></i> -->
<!-- 						</span>保存</a> -->
<!-- 					</li> -->
<!-- 					<li><a class="closecutab"><span class="iconbg03"><i -->
<!-- 								class="fa fa-remove  font24"></i> -->
<!-- 						</span>关闭</a> -->
<!-- 					</li> -->
<!-- 				</ul> -->
<!-- 			</div> -->
<!-- 		</div> -->
<!-- 	</div> -->
<!-- </div> -->
<div class="bjui-pageContent">
	<form id="serverform" action="">	
	<div style="margin:15px auto 0;">
		<fieldset>
			<legend>
				<h3 class="listtitle" id="unitTitle">服务器信息</h3>
				<input type="hidden" name="id" value="${entity.id!}" />
				<input type="hidden" id="types" value="${types!}">
				<input id="serverImportSelected" type="hidden" name="entity.projectId" value="${projectId!}">
				<input id="selectRealName" type="hidden"  value="${selectRealName!}">
			</legend>
			
			<table class="table table-condensed" width="100%">
				<tbody>
				    <tr>	
						<td class="right"><span style="color:red;">*</span>服务器名称</td>
						<td class="left">
							<div class="input-group col-lg-6">
							<input id="serverName"
							name="entity.serverName" type="text" data-rule="required;length[~50]"  onkeyup="getText(this)"
							value="${entity.serverName!}" size="20" />
                         <span class="input-group-btn" id="bd_code_import">
                                    <button id="server_import_button" class="btn btn-default" type="button" onclick="serverImport(this)">导入</button>
						 </span>
							</div>
						</td>
                          <td class="right" style="width: 130px"><span style="color:red">*</span>服务器类型</td>
                    <td id="type" class="left" colspan="3">
                      <#if types??>
						     <#if types=="view">
					           <#if entity.type=="01"><input name="entity.type" type="text" data-rule="required" readonly="readonly" size="20" value="应用服务器"></#if>
               				   <#if entity.type=="02"><input name="entity.type" type="text" data-rule="required" readonly="readonly" size="20" value="前置机服务器" ></#if>
               				   <#if entity.type=="03"><input name="entity.type" type="text" data-rule="required" readonly="readonly" size="20" value="数据中心服务器" ></#if>
               		   <#else>   
                             <select name="entity.type"  data-toggle="selectpicker" data-rule="required" data-width="200">
				             <option selected="selected" value="">--请选择--</option>
				             <option value="01"
				             <#if (entity.type!)=='01'> selected="selected"</#if>
				             >应用服务器</option>
				             <option value="02"
				             <#if (entity.type!)=='02'> selected="selected"</#if>
				             >前置机服务器</option>
				             <option value="03"
				             <#if (entity.type!)=='03'> selected="selected"</#if>
				             >数据中心服务器</option>/>
	         			</select>
	         			</#if>
	         			<#else>
	         			<select name="entity.type"  data-toggle="selectpicker" data-rule="required" data-width="200">
				             <option selected="selected" value="">--请选择--</option>
				             <option value="01"
				             <#if (entity.type!)=='01'> selected="selected"</#if>
				             >应用服务器</option>
				             <option value="02"
				             <#if (entity.type!)=='02'> selected="selected"</#if>
				             >前置机服务器</option>
				             <option value="03"
				             <#if (entity.type!)=='03'> selected="selected"</#if>
				             >数据中心服务器</option>/>
	         			</select>
	         			</#if>                        
	         			</td>
					</tr>
<!-- 					<tr>	 -->
<!-- 						<td class="right"><span style="color:red;">*</span>项目ID</td> -->
<!-- 						<td class="left"><input id="projectId" -->
<!-- 							name="entity.projectId" type="text" data-rule="required" maxlength="25" onkeyup="getText(this)" -->
<!-- 							value="${projectId!}" size="20" /></td> -->
<!-- 					</tr> -->
					
<!-- 					<tr>	 -->
<!-- 						<td class="right"><span style="color:red;">*</span>服务器类型</td> -->
<!-- 						<td class="left"><input id="type" -->
<!-- 							name="entity.type" type="text" data-rule="required" maxlength="25" onkeyup="getText(this)" -->
<!-- 							value="${entity.type!}" size="20" /></td> -->
<!-- 					</tr>	 -->
					<tr>
						<td class="right"><span style="color:red;">*</span>服务器用户名</td>
						<td class="left"><input id="serverUsername"
							name="entity.serverUsername" type="text" data-rule="required;length[~50]" onkeyup="getText(this)"
							value="${entity.serverUsername!}" size="20" /></td>	
						<td class="right"><span style="color:red;">*</span>服务器密码</td>
						<td class="left"><input id="serverPassword"
							name="entity.serverPassword" type="text" data-rule="required;length[~50]" onkeyup="getText(this)"
							value="${entity.serverPassword!}" size="20" /></td>
					</tr>
					<tr>	
						<td class="right"><span style="color:red;">*</span>服务器远程地址</td>
						<td class="left"><input id="serverIp"
							name="entity.serverIp" type="text"  onblur="installserverRemoteIp(this)" data-rule="required;length[~50]"   onkeyup="getText(this)"
							value="${entity.serverIp!}" size="20" /></td>
							<td class="right">服务器MAC</td>
						<td class="left"><input id="serverMac"
							name="entity.serverMac" type="text"  data-rule="length[~50]" onkeyup="getText(this)"
							value="${entity.serverMac!}" size="20" /></td>
					</tr>
					<tr>	
						<td class="right"><span style="color:red;">*</span>服务器内网IP</td>
						<td class="left"><input id="serverInsideIp"
							name="entity.serverInsideIp" type="text"  data-rule="required;length[~50]" onkeyup="getText(this)"
							value="${entity.serverInsideIp!}" size="20" /></td>
							<td class="right">服务器外网IP</td>
						<td class="left"><input id="serverOutsideIp"
							name="entity.serverOutsideIp" type="text"  data-rule="	length[~50]" onkeyup="getText(this)"
							value="${entity.serverOutsideIp!}" size="20" /></td>
					</tr>
					<tr>
					  <#if types??>
						 <#if types=="view">
						<td class="right">是否删除</td>
						<td class="left" colspan="3">						
						         <#if entity.isDel== '1'><div title="是" class="label label-success">是</div></#if>
                    			 <#if entity.isDel== '0'><div title="否" class="label label-danger">否</div></#if>
						     <#else>
							</#if>
							</#if>
						</td>
					</tr>
					<tr>		
						<td class="right" style="width: 130px">备注</td>
                        <td class="left" colspan="7">
                            <textarea rows="4" id="remarks" name="entity.remark" data-rule="length[~100]" size="67">${entity.remark!}</textarea>
                        </td>
                        
					</tr>
				</tbody>
			</table>
		</fieldset>
	</div>
</form>
</div>
<div class="bjui-pageFooter">
    <ul>
        <li>
            <button type="button" class="btn-close closecutab" data-icon="close">关闭</button>
        </li>
        <li <#if types??><#if types == "view">hidden="true"</#if></#if>>
            <button onclick="serversersaveForm(this,'${ctx}/project/equipmentinfor!save.do','serverform')" class="btn-default" data-icon="save">保存</button>
        </li>
    </ul>
</div>
<script type="text/javascript">
    function serversersaveForm(obj, url, formId) {
        var dataForms = $("#" + formId);
        var $formFlag = dataForms.isValid();
        if ($formFlag) {
            $.ajax({
                type : "POST",
                url : url,
                data : $("#" + formId).serialize(),
                success : function(data) {
                    var dataJson = eval('(' + data + ')');
                    if (dataJson.statusCode == 300) {
						var message="该服务器名称已经存在，是否继续保存？";
						$(obj).alertmsg("confirm", message, {
							okCall: function () {
								reServersersaveForm(this, '${ctx}/project/equipmentinfor!reSave.do', 'serverform');
							}
						})
                    } else if (dataJson.statusCode == 200) {
                        $(this).alertmsg('correct', dataJson.message);
                        $(this).dialog("close", $.CurrentDialog);
                        $("#serverSearch").click();
                    }
                }
            })
        }
    };

	function reServersersaveForm(obj, url, formId) {
		debugger;
		var dataForms = $("#" + formId);
		var $formFlag = dataForms.isValid();
		if ($formFlag) {
			$.ajax({
				type : "POST",
				url : url,
				data : $("#" + formId).serialize(),
				success : function(data) {
					var dataJson = eval('(' + data + ')');
					if (dataJson.statusCode == 300) {
						$(this).alertmsg('warn', dataJson.message);
					} else if (dataJson.statusCode == 200) {
						$(this).alertmsg('correct', dataJson.message);
						$(this).dialog("close", $.CurrentDialog);
						$("#serverSearch").click();
					}
				}
			})
		}
	};
    function setInsStatus(flag,param){
    	if(flag){
        	$("#"+param).val("1");//启用
   	 	}else{
        	$("#"+param).val("0");//禁用
   	 	}
	}

	function serverImport(obj) {
		var serverImportSelected=$("#serverImportSelected").val();
		var selectRealName=$("#selectRealName").val();
		var url = "${ctx}/project/equipmentinfor!serList.do?serverImportSelected="+serverImportSelected;
		var options = {
			width : "1200",
			height : "800",
			type:'post',
			fresh:true,
			mask : true,
			id : "ser_import_select",
			url : url,
			title : '服务器选择'
		}
		$(obj).dialog(options);
	}

    
    $(function(){
		var _id = $("#types").val();
		if(_id!=null && _id!=""){
			if (_id == "view") {
				$("table").find("input").each(function(){
					$(this).attr("readonly", "readonly");
				});
				$("textarea").attr("readonly", "readonly");
				$("#server_import_button").hide();

			}
		}
		
	})

	function installserverRemoteIp (obj) {
		debugger;
		var outsideIp=$(obj).val();
		var isOrNot=outsideIp.indexOf(":");
		if(-1==isOrNot){
			_d("#serverOutsideIp").val(outsideIp);

		}else{
			var data=outsideIp.substr(0, outsideIp.indexOf(':'));
			_d("#serverOutsideIp").val(data);
		}
	}
</script>