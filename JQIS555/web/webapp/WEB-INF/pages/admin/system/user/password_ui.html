<#include "../../../common/_public.html"/>
<div class="bjui-pageContent">
<form action="${ctx}/admin/system/user!modifypassword.do" id="password_form" data-toggle="validate" >
<div style="margin:15px auto 0; width:100%;">
<!-- <fieldset> -->
    <table class="table table-bordered" width="90%">
        <tbody>
        <input id="password" name="password" type="hidden" value=""/>
        <tr>
            <td class="right" style="width: 100px">原始密码</td>
            <td class="left">
                <input id="oldPassword" name="oldPassword" type="password"  data-rule="required" value="" size="20" />
                <span style="color: red;">*</span>
            </td>
        </tr>
        <tr>
            <td class="right">新密码</td>
            <td class="left">
                <input id="npassword" name="npassword" type="password" data-rule="required" value=""   size="20" />
                <span style="color: red;">*</span>
            </td>
        </tr>
         <tr>
            <td class="right">新密码确认</td>
           <td class="left">
                <input id="npassword2" name="npassword2" type="password" data-rule="required" value="" onblur="check();"   size="20" />
                <span style="color: red;">*</span>
            </td>
          </tr>
    </table>
<!-- </fieldset> -->

</div>
</form>
</div>
<div class="bjui-pageFooter">
    <ul>
        <li>
            <button type="button" class="btn-close closecutab" id="reset_password_close" data-icon="close">关闭</button>
        </li>
        <li>
            <button id="saveSubmit" type="button" class="btn-default" data-icon="save" onclick="savePasswordBefore();">保存</button>
        </li>
    </ul>
</div>

<script type="text/javascript">
		function check(){
			var newPassword = $.trim($("#npassword").val());
			var newPassword2 = $.trim($("#npassword2").val());
			if(newPassword!=newPassword2){
				//初始化验证，并且引用验证的实例
				var v = $("#password_form").validator().data('validator');
				v.showMsg('#npassword2',"两次输入的新密码不一致");
				return;
			}
		}

		function savePasswordBefore(){
			var $formFlag = $("#password_form").isValid();
			if($formFlag==false) return;
			//验证新密码输入的是否一致
			check();
			//提交保存
			$.ajax({
				type:'post',
				data:$("#password_form").serialize(),
				url:'${ctx}/admin/system/user!modifypassword.do',
				success:function(data){
					var dataJson = eval('(' + data + ')');
		       		if (dataJson.statusCode == 300) {
		       			$(this).alertmsg('warn',dataJson.message);
		       		} else if (dataJson.statusCode == 200) {
		       			$(this).alertmsg('correct',dataJson.message+",1秒后跳转登录页面!");
		       			setTimeout("loginOut()",2000);
		       		}
				}
			});
		}
		
	//重定向到登录页面
	function loginOut(){
		window.location.href ="${ctx}/j_spring_security_logout";
	}
</script>
